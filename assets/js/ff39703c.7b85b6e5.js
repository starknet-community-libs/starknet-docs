"use strict";(self.webpackChunkstarknet_docs=self.webpackChunkstarknet_docs||[]).push([[483],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),h=c(a),u=r,k=h["".concat(l,".").concat(u)]||h[u]||p[u]||i;return a?n.createElement(k,s(s({ref:t},d),{},{components:a})):n.createElement(k,s({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},9879:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return d},default:function(){return h}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),s=["components"],o={},l="StarkGate \u2013 Token Bridge",c={unversionedId:"L1<>L2 Communication/token-bridge",id:"L1<>L2 Communication/token-bridge",title:"StarkGate \u2013 Token Bridge",description:"StarkGate General Architecture",source:"@site/docs/L1<>L2 Communication/token-bridge.md",sourceDirName:"L1<>L2 Communication",slug:"/L1<>L2 Communication/token-bridge",permalink:"/docs/L1<>L2 Communication/token-bridge",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/L1<>L2 Communication/token-bridge.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Messaging Mechanism",permalink:"/docs/L1<>L2 Communication/messaging-mechanism"},next:{title:"StarkNet State",permalink:"/docs/State/starknet-state"}},d=[{value:"StarkGate General Architecture",id:"starkgate-general-architecture",children:[{value:"L1\u2192L2 Transfer (Deposit)",id:"l1l2-transfer-deposit",children:[{value:"Step 1: Call The Deposit Function on L1",id:"step-1-call-the-deposit-function-on-l1",children:[],level:4},{value:"Step 2: Deposit Triggered on StarkNet",id:"step-2-deposit-triggered-on-starknet",children:[],level:4},{value:"Step 3: The Block That Includes The Transfer Is Proved",id:"step-3-the-block-that-includes-the-transfer-is-proved",children:[],level:4}],level:3},{value:"L2\u2192L1 Transfer (Withdraw)",id:"l2l1-transfer-withdraw",children:[{value:"Step 1: Call The Withdraw Function on L2",id:"step-1-call-the-withdraw-function-on-l2",children:[],level:4},{value:"Step 2: The Block That Includes The Transaction Is Proved",id:"step-2-the-block-that-includes-the-transaction-is-proved",children:[],level:4},{value:"Step 3: Transfering The Funds On L1",id:"step-3-transfering-the-funds-on-l1",children:[],level:4}],level:3}],level:2},{value:"StarkGate Alpha Limitations",id:"starkgate-alpha-limitations",children:[],level:2}],p={toc:d};function h(e){var t=e.components,a=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"starkgate--token-bridge"},"StarkGate \u2013 Token Bridge"),(0,i.kt)("h2",{id:"starkgate-general-architecture"},"StarkGate General Architecture"),(0,i.kt)("p",null,"StarkGate is the Ethereum\u2194StarkNet token bridge developed by StarkWare. Each supported token is associated with an L1 and L2 bridge contracts that are communicating via StarkNet's messaging mechanism."),(0,i.kt)("p",null,"The bridges facilitate a user\u2019s ability to conduct their transactions with their ETH and ERC-20 tokens that reside on L1, via the StarkNet Alpha network and its STARK-based computational compression capabilities. For simplicity, we use terms such as \u201cdeposit\u201d, \u201ctransact\u201d, and \u201ctransfer\u201d to refer to various operations involving a bridge, even though ETH and ERC20 tokens never actually leave Ethereum."),(0,i.kt)("h3",{id:"l1l2-transfer-deposit"},"L1\u2192L2 Transfer (Deposit)"),(0,i.kt)("h4",{id:"step-1-call-the-deposit-function-on-l1"},"Step 1: Call The Deposit Function on L1"),(0,i.kt)("p",null,"The user calls the function ",(0,i.kt)("inlineCode",{parentName:"p"},"deposit")," (see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/solidity/StarknetERC20Bridge.sol#L10"},"ERC-20 deposit")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/solidity/StarknetEthBridge.sol#L10"},"ETH deposit"),"), supplying as parameters the recipient address on StarkNet and the amount to transfer in the case of ERC-20 token. The deposit function then:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Checks that the funds transferred are within the Alpha ",(0,i.kt)("a",{parentName:"li",href:"/docs/L1%3C%3EL2%20Communication/token-bridge#starkgate-alpha-limitations"},"limitations")),(0,i.kt)("li",{parentName:"ul"},"Transfers the funds from the user account to the StarkNet bridge"),(0,i.kt)("li",{parentName:"ul"},"Emits a deposit ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/solidity/StarknetTokenBridge.sol#L101"},"event")," with the sender address on L1, the recipient address on L2, and the amount"),(0,i.kt)("li",{parentName:"ul"},"Sends a message to the relevant L2 bridge with the amount to be transferred, and the recipient address as parameters. Note that, since every single bridge is dedicated to one token type, the token type doesn't have to be explicit here.")),(0,i.kt)("p",null,"At the end of this step (i.e., after the execution on L1) the deposit transaction is known to StarkNet\u2019s sequencer, yet sequencers may wait for enough L1 confirmations before corresponding deposit transaction is initated on L2. During this step, the status of the L2 deposit transaction is ",(0,i.kt)("a",{parentName:"p",href:"/docs/Blocks/transaction-life-cycle#not_received"},(0,i.kt)("inlineCode",{parentName:"a"},"NOT_RECEIVED")),"."),(0,i.kt)("h4",{id:"step-2-deposit-triggered-on-starknet"},"Step 2: Deposit Triggered on StarkNet"),(0,i.kt)("p",null,"Once enough block confirmations are received for step 1, the sequencers may refer to the deposit request by triggering the L1 handler \u201c\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/cairo/token_bridge.cairo#L135"},(0,i.kt)("inlineCode",{parentName:"a"},"handle_deposit"))," on the L2 bridge. The function ",(0,i.kt)("inlineCode",{parentName:"p"},"handle_deposit")," verifies that the deposit indeed came from the corresponding L1 bridge. It then calls to the relevant ERC-20 contract (e.g. the ERC-20 representing ETH on StarkNet) and mints the tokens for the user."),(0,i.kt)("p",null,"At the end of this step (i.e., after the sequencer processed this transaction, but before a proof is generated), the status of the deposit request will be ",(0,i.kt)("a",{parentName:"p",href:"/docs/Blocks/transaction-life-cycle#accepted_on_l2"},(0,i.kt)("inlineCode",{parentName:"a"},"ACCEPTED_ON_L2")),"."),(0,i.kt)("h4",{id:"step-3-the-block-that-includes-the-transfer-is-proved"},"Step 3: The Block That Includes The Transfer Is Proved"),(0,i.kt)("p",null,"Once the sequencer completes the block construction, StarkNet\u2019s provers will prove its validity and submit a state update to L1. When this happens, the message confirming the funds transfer will be cleared from the StarkNet Core Contract, and the fact that the user has transferred their funds will be part of the now finalized state of StarkNet. Note that if the message wasn\u2019t on L1 to begin with (meaning StarkNet \u201cinvented\u201d a deposit request), the state update would fail."),(0,i.kt)("h3",{id:"l2l1-transfer-withdraw"},"L2\u2192L1 Transfer (Withdraw)"),(0,i.kt)("h4",{id:"step-1-call-the-withdraw-function-on-l2"},"Step 1: Call The Withdraw Function on L2"),(0,i.kt)("p",null,"To initiate a withdraw, a user calls the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/cairo/token_bridge.cairo#L103"},(0,i.kt)("inlineCode",{parentName:"a"},"initiate_withdraw"))," function on the L2 bridge contract, supplying as parameters the recipient address on Ethereum, as well as the amount to transfer. The withdraw function then:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Burns the transferred amount of tokens from the balance of the withdrawal\u2019s initiator"),(0,i.kt)("li",{parentName:"ul"},"Sends a message to the relevant L1 bridge with the amount to be transferred, and the recipient address as parameters. As before, since the bridgs are token-specific, the token itself is implicit here.")),(0,i.kt)("h4",{id:"step-2-the-block-that-includes-the-transaction-is-proved"},"Step 2: The Block That Includes The Transaction Is Proved"),(0,i.kt)("p",null,"Once the sequencer completes the block construction, StarkNet\u2019s provers will prove the validity of the block and submit a state update to L1. When this happens, the message from the previous step is stored in the StarkNet Core Contract."),(0,i.kt)("h4",{id:"step-3-transfering-the-funds-on-l1"},"Step 3: Transfering The Funds On L1"),(0,i.kt)("p",null,"After the withdraw message has been recorded on the StarkNet Core Contract, anyone can finalize the transfer on L1 from the bridge back to the user, by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"withdraw")," function (see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/solidity/StarknetERC20Bridge.sol#L19"},"ERC-20 withdraw")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/starkgate-contracts/blob/28f4032b101003b2c6682d753ea61c86b732012c/src/starkware/starknet/apps/starkgate/solidity/StarknetEthBridge.sol#L16"},"ETH withdraw"),")."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Note that this step is permissionless, and may be performed by anyone. Since the user's address is part of the recorded message on L1, he will be the recepient of the funds, regardless of who called the ",(0,i.kt)("inlineCode",{parentName:"p"},"withdraw")," function on L1."))),(0,i.kt)("h2",{id:"starkgate-alpha-limitations"},"StarkGate Alpha Limitations"),(0,i.kt)("p",null,"In order to reduce the risks involved in using an Alpha version, StarkGate Alpha has limitations ",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," involving the deposit amount and total value locked in the L1 bridge contract:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Token"),(0,i.kt)("th",{parentName:"tr",align:null},"Max deposit"),(0,i.kt)("th",{parentName:"tr",align:null},"Max total value locked"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ETH"),(0,i.kt)("td",{parentName:"tr",align:null},"0.25 Eth"),(0,i.kt)("td",{parentName:"tr",align:null},"320 Eth")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DAI"),(0,i.kt)("td",{parentName:"tr",align:null},"50 Dai"),(0,i.kt)("td",{parentName:"tr",align:null},"100,000 Dai")))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"We plan to gradually ease these limitations and lift them completely, as confidence grows.\nChanges will be updated here, stay tuned."))),(0,i.kt)("p",null,(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," Only relveant for Mainnet Alpha"))}h.isMDXComponent=!0}}]);